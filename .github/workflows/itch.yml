name: Deploy to itch.io

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up PNPM
        uses: pnpm/action-setup@v2.2.4
        with:
          version: latest

      - name: Install dependencies
        run: pnpm install

      - name: Build
        run: pnpm run build

      - name: Upload Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: game-artifacts
          path: './dist'

      - name: Download Artifacts
        uses: actions/download-artifact@v2.0.8
        with:
          name: game-artifacts
          path: './dist'
      - name: Publish to itch.io
        uses: KikimoraGames/itch-publish@v0.0.3
        with:
          butlerApiKey: ${{ secrets.BUTLER_API_KEY }}
          gameData: './dist'
          itchUsername: alee208
          itchGameId: dancing-troll
          buildChannel: webgl
